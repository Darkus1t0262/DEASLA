name: Run All Microservice Tests

on:
  push:
    branches: [test]
  pull_request:
    branches: [test]

jobs:
  test-core:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [
          'user-service',
          'auth-service',
          'role-service',
          'profile-service',
          'language-service'
        ]

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run tests in domains/core/${{ matrix.service }}
        run: |
         cd domains/core/${{ matrix.service }}
         if [ -f package.json ]; then
          npm install
          npm install --save-dev supertest
          npm test
         fi


  test-alert:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        service: [
          'geo-service',
          'alert-service',
          'schedule-service',
          'template-service',
          'validation-service'
        ]

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Run tests in domains/alert-management/${{ matrix.service }}
        run: |
          cd domains/alert-management/${{ matrix.service }}
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
            pytest tests
          elif [ -f package.json ]; then
            npm install
            npm test
          fi
